<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SQLite Playground</title>

  <!-- SQL.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>

  <!-- ‚úÖ Bootstrap 5 -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  ></script>

  <style>
    body {
      background-color: #f8f9fa;
      font-family: system-ui, sans-serif;
    }

    .table-container {
      position: relative;
    }

    /* üö´ Disable selection only inside results table */
    .results-table {
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }

    /* Prevent highlight/selection visually */
    .results-table *::selection {
      background: transparent;
    }
    .results-table *::-moz-selection {
      background: transparent;
    }

    /* Keep normal behavior everywhere else */
    textarea, input, button {
      user-select: text !important;
      -webkit-user-select: text !important;
    }
  </style>
</head>

<body class="bg-light p-4">
  <div class="container">
    <h2 class="mb-3 text-center">Quiz Detektif SQL üïµÔ∏è</h2>

    <div class="text-center mb-3">
      <a href="javascript:void(0)" onclick="tampilkanSkema()" class="me-2 btn btn-warning">Hint üí°</a>
      <a href="https://thel1012.github.io/q1a/" class="text-decoration-none btn btn-success">Submit Jawaban</a>
    </div>

    <div class="mb-3">
      <label for="sql" class="form-label fw-bold">SQL Query</label>
      <textarea id="sql" class="form-control" rows="6" placeholder="Masukkan Query SQL di sini"></textarea>
    </div>

    <div class="d-grid d-sm-flex justify-content-sm-between">
      <button id="run" class="btn btn-primary px-4">Run SQL</button>
    </div>

    <div id="output" class="mt-4"></div>
  </div>

  <script>
    let currentDb = null;

    initSqlJs({ locateFile: file =>
      `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${file}`
    }).then(async SQL => {
      const db = new SQL.Database();
      currentDb = db;

      // ‚úÖ Dynamically load your actual SQL file
      try {
        const sqlText = await fetch("mydata.sql").then(res => res.text());
        db.run(sqlText);
      } catch (e) {
        console.error("Error loading SQL file:", e);
      }

      const runBtn = document.getElementById("run");
      const output = document.getElementById("output");

      runBtn.onclick = () => {
        const queryRaw = document.getElementById("sql").value.trim();
        const upper = queryRaw.toUpperCase();

        // Allow only SELECT statements
        if (!upper.startsWith("SELECT")) {
          output.innerHTML = '<div class="alert alert-danger">‚ùå Only SELECT queries are allowed.</div>';
          return;
        }

        try {
          const results = db.exec(queryRaw);
          if (results.length === 0) {
            output.innerHTML = '<div class="alert alert-info">Query executed (no results)</div>';
          } else {
            const table = results[0];
            let html = `
              <div class="table-container">
                <div class="table-responsive">
                  <table class="table table-striped table-bordered mt-3 results-table">
                    <thead class="table-light">
                      <tr>${table.columns.map(col => `<th>${col}</th>`).join('')}</tr>
                    </thead>
                    <tbody>
                      ${table.values.map(row =>
                        `<tr>${row.map(val => `<td>${val}</td>`).join('')}</tr>`
                      ).join('')}
                    </tbody>
                  </table>
                </div>
              </div>`;
            output.innerHTML = html;
          }
        } catch (e) {
          output.innerHTML = `<div class="alert alert-danger">Error: ${e.message}</div>`;
        }
      };
    });

    // ‚úÖ Disable Ctrl+F only when a results table is present
    document.addEventListener('keydown', function(e) {
      if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
        const output = document.getElementById('output');
        if (output.querySelector('table.results-table')) {
          e.preventDefault();
          return false;
        }
      }
    });
  </script>

  <!-- ‚úÖ Bootstrap Modal -->
  <div class="modal fade" id="skemaModal" tabindex="-1" aria-labelledby="skemaLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="skemaLabel">Skema Database</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body text-center">
          <p>Cari pelaku pembunuhan di <strong>Kompleks Anggrek</strong> tanggal <strong>17 Juli 2020</strong></p>
          <div style="background-color: #f8f9fa; padding: 20px; border-radius: 5px;">
            <img src="skema.jpg" alt="skema" class="img-fluid mx-auto d-block">
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function tampilkanSkema() {
      const modal = new bootstrap.Modal(document.getElementById('skemaModal'));
      modal.show();
    }
  </script>
</body>
</html>
